# PostgreSQL database

# Global labels (used by PriorityClass/PDBs and common templates)
project: "{{cookiecutter.project_name}}"
environment: prod
env: prod
owner: "{{cookiecutter.team_name}}"

# Common annotations applied to workloads (used by kube-linter required-annotation-email)
commonAnnotations:
  email: "{{cookiecutter.team_name}}@gov.bc.ca"

# Ensure PriorityClass exists for workloads (Polaris priorityClassNotSet)
priorityClass:
  create: true
  name: "{{cookiecutter.app_name}}-normal"
  value: 1000
  globalDefault: false
  description: "Default application priority"

# Normal Postgres DB instance
postgresql:
  enabled: false
  image:
    pullPolicy: Always
  commonLabels:
    environment: prod
    env: prod
    owner: "{{cookiecutter.team_name}}"
    project: "{{cookiecutter.project_name}}"
    DataClass: "Medium"
  primary:
    podSecurityContext:
      enabled: false
    containerSecurityContext:
      enabled: false
    networkPolicy:
      enabled: false
    labels:
      environment: prod
      env: prod
      owner: "{{cookiecutter.team_name}}"
      project: "{{cookiecutter.project_name}}"
      DataClass: "Medium"
    podLabels:
      environment: prod
      env: prod
      owner: "{{cookiecutter.team_name}}"
      project: "{{cookiecutter.project_name}}"
      DataClass: "Medium"
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        memory: 256Mi
        cpu: 100m

#  this will create postgres database with HA and 3 nodes. set to 3 in prod
# Simple PostgreSQL database
# NOTE: For production, consider using a managed database service
postgresql:
  enabled: false
  auth:
    username: appuser
    password: changeme  # Change this in production!
    database: appdb
  image:
    pullPolicy: Always
  primary:
    podSecurityContext:
      enabled: false
    containerSecurityContext:
      enabled: false
    persistence:
      enabled: true
      size: 256Mi
    resources:
      limits:
        cpu: 50m
        memory: 256Mi
      requests:
        cpu: 20m
        memory: 100Mi
    initdb:
      scripts:
        01_init_schema.sql: |
          -- Sample schema for testing
          CREATE TABLE IF NOT EXISTS public.users (
              id SERIAL PRIMARY KEY,
              username VARCHAR(255) UNIQUE NOT NULL,
              email VARCHAR(255),
              created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
          );

          CREATE TABLE IF NOT EXISTS public.sessions (
              id SERIAL PRIMARY KEY,
              user_id INTEGER REFERENCES users(id),
              token VARCHAR(255),
              expires_at TIMESTAMP
          );

          -- Insert sample data
          INSERT INTO public.users (username, email) VALUES
          ('admin', 'admin@example.com'),
          ('user1', 'user1@example.com'),
          ('user2', 'user2@example.com')
          ON CONFLICT (username) DO NOTHING;
  commonLabels:
    environment: prod
    env: prod
    owner: "{{cookiecutter.team_name}}"
    project: "{{cookiecutter.project_name}}"
    DataClass: "Medium"
    app.kubernetes.io/part-of: "{{cookiecutter.project_name}}"
  commonAnnotations:
    datree.skip/CUSTOM_WORKLOAD_INCORRECT_NETWORKS: "skipping this policy"

telnet:
  enabled: true
  goldService: "sso-e27db1-dev.apps.gold.devops.gov.bc.ca" # tetsing connectivity from emerald to a service GOLD using telnet
  goldPort: 80
  diamSSO: common-sso.justice.gov.bc.ca # testing outbound to DIAM Common-SSO
  diamPort: 80
  diamEgressIP: 142.34.208.118/32 # PROD DIAM IP
  justinEgressIP: 142.34.47.201/32 # JUSTIN PROD IP
  publicService: "https://docker.io" # testing connectivity from emerald to internet via web proxy using curl
  gitHubUrl: "https://github.com/bcgov/JAG-GITOPS-TEMPLATE.git" # test connectivity outbound to github via git clone
  commonLabels:
    environment: prod
    env: prod
    owner: "{{cookiecutter.team_name}}"
    project: "{{cookiecutter.project_name}}"
    DataClass: "Medium"
    app.kubernetes.io/part-of: "{{cookiecutter.project_name}}"

frontend:
  enabled: true
  environment: prod
  env: prod
  owner: "{{cookiecutter.team_name}}"
  project: "{{cookiecutter.project_name}}"
  part: "{{cookiecutter.project_name}}"
  replicaCount: 2
  keycloak:
    authUrl: https://sso-e27db1-dev.apps.gold.devops.gov.bc.ca/auth
    realm: ISB
    clientId: react-baseapp
  apiUrl: "{{cookiecutter.app_name}}-webapi-core:8080"
  podLabels:
    DataClass: "Medium"
  priorityClassName: "{{cookiecutter.app_name}}-normal"
  route:
    host: react-baseapp-{{cookiecutter.licence_plate}}-prod.apps.emerald.devops.gov.bc.ca
    annotations:
      aviinfrasetting.ako.vmware.com/name: "dataclass-medium"

backend:
  enabled: true
  environment: prod
  app_name: "{{cookiecutter.app_name}}"
  env: prod
  owner: "{{cookiecutter.team_name}}"
  project: "{{cookiecutter.project_name}}"
  part: "{{cookiecutter.project_name}}"
  replicaCount: 2
  keycloak:
    realmUrl: https://sso-e27db1-dev.apps.gold.devops.gov.bc.ca/auth/realms/ISB
    adminClientId: WEB-API
    ClientId: WEB-API
  database:
    connectionString: "Host={{cookiecutter.app_name}}-postgresql;Port=5432;Database=appdb;Username=appuser;Password=changeme"
  podLabels:
    DataClass: "Medium"
  priorityClassName: "{{cookiecutter.app_name}}-normal"
